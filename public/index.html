<!DOCTYPE html>
<html lang="vi" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Abc's Noob</title>
<link href="assets/base.css" rel="stylesheet">
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
<style>
body{background:#121212;color:#e0e0e0;font-family:Arial,sans-serif;padding:20px;}
.logo{height:50px;} h1,h2{color:#00ffff;} form{margin-top:30px;background:#1e1e1e;padding:20px;border:2px solid #00ffff;border-radius:10px;max-width:500px;}
input[type="text"]{width:100%;padding:10px;font-size:16px;background:#222;color:#fff;border:1px solid #555;border-radius:6px;}
button{margin-top:12px;padding:10px 16px;font-size:16px;cursor:pointer;background-color:#00bcd4;color:#fff;border:none;border-radius:6px;}
[data-dir="rtl"]{direction:rtl;text-align:right;}
</style>
</head>
<body>

<a href="/"><img src="assets/abcsnoob.webp" alt="logo" class="logo"></a>
<h1 id="title">Abc's Noob</h1>

<!-- Dropdown ngÃ´n ngá»¯ -->
<form method="get" id="langForm">
<select id="langSelect"></select>
</form>

<!-- Quota overlay -->
<div id="quota-overlay" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);color:#fff;z-index:9999;display:flex;align-items:center;justify-content:center;">
<div class="overlay-content" style="text-align:center;max-width:90%;">
<h2 id="quota-title" style="color:#ff4444;">Háº¿t quota!</h2>
<p id="quota-message">Báº¡n Ä‘Ã£ sá»­ dá»¥ng háº¿t lÆ°á»£t hÃ´m nay.</p>
<p>Reset sau: <span id="quota-reset-time"></span></p>
</div>
</div>
<div id="quota-info"></div>

<!-- Form tÃ¬m kiáº¿m -->
<form id="searchForm">
<input type="text" id="usernameInput" placeholder="TÃ i khoáº£n Dream" required>
<div class="cf-turnstile" data-sitekey="0x4AAAAAAB7256ItUJTgohro" data-callback="handleTurnstileSuccess"></div>
<button type="submit">TÃ¬m kiáº¿m</button>
</form>

<!-- Popular skins -->
<div class="data-section" id="popular-skins">
<h2>Popular Skins</h2>
</div>

<!-- Popular Youtubers -->
<div class="data-section" id="popular-youtubers">
<h2>Popular Youtubers</h2>
</div>

<footer>
&copy; 2009 - <span id="year"></span> Abc's Noob
</footer>

<script>
document.getElementById('year').textContent = new Date().getFullYear();

const supportedLangs = {
  'vi':'ðŸ‡»ðŸ‡³ Tiáº¿ng Viá»‡t','en':'ðŸ‡ºðŸ‡¸ English','ja':'ðŸ‡¯ðŸ‡µ æ—¥æœ¬èªž','ru':'ðŸ‡·ðŸ‡º Ð ÑƒÑÑÐºÐ¸Ð¹',
  'es':'ðŸ‡ªðŸ‡¸ EspaÃ±ol','fr':'ðŸ‡«ðŸ‡· FranÃ§ais','de':'ðŸ‡©ðŸ‡ª Deutsch','it':'ðŸ‡®ðŸ‡¹ Italiano',
  'ar':'ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©','zh':'ðŸ‡¨ðŸ‡³ ä¸­æ–‡','ko':'ðŸ‡°ðŸ‡· í•œêµ­ì–´','hi':'ðŸ‡®ðŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€','pt':'ðŸ‡µðŸ‡¹ PortuguÃªs','tr':'ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e'
};

const langSelect = document.getElementById('langSelect');
for(let code in supportedLangs){
  const opt = document.createElement('option');
  opt.value = code; opt.textContent = supportedLangs[code];
  langSelect.appendChild(opt);
}

let lang = localStorage.getItem('lang') || navigator.language.slice(0,2);
if(!supportedLangs[lang]) lang='vi';
langSelect.value = lang;

langSelect.onchange = ()=>{
  localStorage.setItem('lang', langSelect.value);
  location.reload();
};

// Load translations
async function loadTranslations(){
  const res = await fetch(`/lang/${lang}_home.json`);
  return await res.json();
}

// Turnstile
let turnstileToken = null;
function handleTurnstileSuccess(token){turnstileToken=token;}

// Search form
document.getElementById("searchForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const username = document.getElementById("usernameInput").value.trim();
  if(!username){alert("Nháº­p username"); return;}
  if(!turnstileToken){alert("HoÃ n táº¥t Turnstile"); return;}

  // Call verify function
  const resp = await fetch("/api/verify_turnstile", {
    method:"POST", body:new URLSearchParams({ "cf-turnstile-response": turnstileToken })
  }).then(r=>r.json());

  if(resp.success){
    window.location.href=`/accounts/${encodeURIComponent(username)}`;
  } else {
    alert("XÃ¡c thá»±c tháº¥t báº¡i");
  }
  turnstileToken=null;
});

// Load popular skins/youtubers
async function loadPopular(){
  const skins = await fetch("/api/popular_skins").then(r=>r.text());
  document.getElementById("popular-skins").innerHTML += skins;
  const ytb = await fetch("/api/popular_youtubers").then(r=>r.text());
  document.getElementById("popular-youtubers").innerHTML += ytb;
}
loadPopular();

// Quota
async function loadQuota(){
  try{
    const data = await fetch("/api/quota_status").then(r=>r.json());
    const overlay = document.getElementById("quota-overlay");
    const info = document.getElementById("quota-info");
    if(data.error || data.remaining===0){ overlay.style.display='flex'; }
    else{ info.innerHTML=`âœ… Sá»‘ lÆ°á»£t cÃ²n láº¡i hÃ´m nay: ${data.remaining}`;}
    const resetTS = data.reset_time*1000;
    setInterval(()=>{
      const distance = resetTS - Date.now();
      if(distance<=0) return;
      const h=Math.floor(distance/3600000), m=Math.floor(distance%3600000/60000), s=Math.floor(distance%60000/1000);
      document.getElementById("quota-reset-time").textContent=`${h} giá» ${m} phÃºt ${s} giÃ¢y`;
    },1000);
  } catch(e){console.error(e);}
}
loadQuota();
</script>

</body>
</html>
